const datasets = [
    {   
        "Беседа": 0.99, "Вершина": 0.98, "Восхождение": 0.98, "Встреча": 0.00, "Гроза": 0.99, 
        "Деньги": 0.99, "Дождь": 0.99, "Дорога": 0.91, "Женщина": 0.97, "Знакомство": 0.98, 
        "Лавина": 0.99, "Любовь": 0.95, "Мечта": 0.97, "Находка": 0.99, "Обвал": 0.99, 
        "Облако": 0.99, "Отдых": 0.98, "Отпуск": 0.98, "Падение": 0.99, "Письмо": 0.99, 
        "Победа": 0.92, "Подарок": 0.99, "Поездка": 0.79, "Покорение": 0.99, "Помощь": 0.98, 
        "Поход": 0.98, "Привал": 0.98, "Прогулка": 0.98, "Птица": 0.99, "Путевка": 0.98, 
        "Путешествие": 0.97, "Путь": 0.98, "Работа": 0.98, "Радость": 0.98, "Снег": 0.96, 
        "Событие": 0.99, "Тропа": 0.96, "Удача": 0.96, "Человек": 0.99
    },
    {   
        "Афиша": 0.99, "Газета": 0.00, "Картина": 0.98, "Красивый": 0.99, "Объявление": 0.99, 
        "Печать": 0.96, "Реклама": 0.96, "Сенсация": 0.99, "Сообщение": 0.99, "Туалет": 0.99, 
        "Фотография": 0.99
    },
    {   
        "Будущее": 0.91, "Вернуться": 0.93, "Видеть": 0.98, "Возвращение": 0.00, "Граница": 0.98, 
        "Далеко": 0.87, "Двинуться": 0.98, "Дом": 0.37, "Дорога": 0.67, "Ехать": 0.85, 
        "Зовет": 0.98, "Идти": 0.83, "Мать": 0.98, "Направление": 0.98, "Ностальгия": 0.98, 
        "Отправиться": 0.98, "Поезд": 0.78, "Радость": 0.91, "Самолет": 0.96, "Собираться": 0.76, 
        "Солдат": 0.98, "Стремление": 0.98, "Сын": 0.98, "Тоска": 0.98, "Хотеть": 0.98, 
        "Эмиграция": 0.98
    },
    {   
        "Беда": 0.98, "Безнадежно": 0.95, "Вера": 0.91, "Вести": 0.98, "Взгляд": 0.61, 
        "Видеть": 0.00, "Движение": 0.95, "Дождь": 0.89, "Друг": 0.98, "Зрение": 0.98, 
        "Идти": 0.98, "Мечта": 0.91, "Музыкант": 0.98, "Мысль": 0.98, "Надежда": 0.89, 
        "Перспектива": 0.98, "План": 0.98, "Поводырь": 0.98, "Предвидеть": 0.86, "Путь": 0.86, 
        "Радость": 0.98, "Случай": 0.98, "Смотреть": 0.82, "Страх": 0.91, "Судьба": 0.98, 
        "Счастье": 0.95, "Удача": 0.98, "Человек": 0.89
    },
    {   
        "Беда": 0.97, "Битва": 0.99, "Война": 0.00, "Воля": 0.99, "Единство": 0.99, 
        "Жизнь": 0.98, "История": 0.98, "Катастрофа": 0.97, "Компания": 0.99, "Кризис": 0.99, 
        "Легенда": 0.99, "Медицина": 0.92, "Молва": 0.99, "Песня": 0.99, "Победа": 0.99, 
        "Политика": 0.99, "Правда": 0.99, "Проблема": 0.98, "Революция": 0.93, "Сила": 0.99, 
        "Сказка": 0.99, "Скорбь": 0.99, "Слава": 0.97, "Событие": 0.99, "Трагедия": 0.98, 
        "Утрата": 0.99
    },
    {   
        "Большой": 0.97, "Взять": 0.92, "Время": 0.03, "Вход": 0.86, "Выигрыш": 0.97, 
        "Деньги": 0.97, "Иметь": 0.83, "Использовать": 0.94, "Касса": 0.86, "Кино": 0.97, 
        "Купе": 0.92, "Купить": 0.94, "Лишний": 0.97, "Место": 0.00, "Много": 0.92, 
        "Находить": 0.97, "Обмен": 0.94, "Отпуск": 0.94, "Отсутствие": 0.97, "Подарить": 0.94, 
        "Поезд": 0.94, "Поездка": 0.81, "Покупать": 0.92, "Получить": 0.89, "Посещение": 0.83, 
        "Потерять": 0.95, "Приобрести": 0.97, "Продажа": 0.92, "Проезд": 0.94, "Путешествие": 0.78, 
        "Самолет": 0.94, "Цена": 0.97, "Человек": 0.92
    },
    {   
        "Армия": 0.95, "Большой": 0.91, "Важный": 0.99, "Вахтер": 0.97, "Военный": 0.00, 
        "Военпред": 0.93, "ВПК": 0.99, "Дисциплина": 0.99, "Долг": 0.98, "Золотой": 0.95, 
        "Идет": 0.99, "Конверсия": 0.99, "Красивый": 0.94, "Купить": 0.99, "Начальник": 0.99, 
        "Новый": 0.97, "Оборонный": 0.99, "Оружие": 0.99, "Офицер": 0.99, "Охрана": 0.99, 
        "Служить": 0.88, "Солдат": 0.99, "Старый": 0.99, "Увидеть": 0.99, "Честь": 0.98, 
        "Ящик": 0.99
    },
    {   
        "Автомобиль": 0.97, "Большой": 0.97, "Взаимопонимание": 0.97, "Война": 0.97, 
        "Входить": 0.00, "Выходить": 0.89, "Друг": 0.97, "Завоевать": 0.94, "Закрыть": 0.94, 
        "Испортить": 0.97, "Ломать": 0.97, "Находить": 0.89, "Открывать": 0.00, "Поднять": 0.97, 
        "Получить": 0.97, "Пользоваться": 0.97, "Потерять": 0.87, "Приобрести": 0.94, 
        "Пройти": 0.97, "Распахнуть": 0.97, "Сломать": 0.91
    },
    {   
        "Билет": 0.90, "Важный": 0.98, "Великолепный": 0.98, "Войти": 0.95, "Встреча": 0.98, 
        "Дальний": 0.95, "Дорогой": 0.95, "Друг": 0.98, "Единственный": 0.95, "Ехать": 0.90, 
        "Забытый": 0.95, "Замкнутый": 0.90, "Знакомый": 0.71, "Идти": 0.98, "Интересный": 0.98, 
        "Красивый": 0.90, "Лучший": 0.95, "Любимый": 0.74, "Маленький": 0.98, "Метро": 0.98, 
        "Милый": 0.95, "Мой": 0.79, "Наш": 0.98, "Общение": 0.98, "Покинуть": 0.95, 
        "Почетный": 0.98, "Родной": 0.90, "Сердце": 0.98, "Старый": 0.88, "Хороший": 0.95
    },
    {   
        "Белый": 0.99, "Билет": 0.00, "Близкий": 0.99, "Дом": 0.99, "Журнал": 0.99, 
        "Змей": 0.98, "Игрушка": 0.92, "Книга": 0.99, "Макет": 0.99, "Пакет": 0.93, 
        "Полотенце": 0.98, "Проездной": 0.99, "Расписание": 0.99, "Салфетка": 0.99, 
        "Собака": 0.99, "Стакан": 0.93, "Товар": 0.98
    },
    {   
        "Белоснежка": 0.99, "Белоснежный": 0.99, "Белый": 0.00, "Вредный": 0.99, 
        "Грязный": 0.98, "Конфета": 0.98, "Леденец": 0.97, "Любимый": 0.97, "Мокрый": 0.99, 
        "Морковь": 0.97, "Нежный": 0.99, "Приятный": 0.99, "Серый": 0.90, "Снежный": 0.99, 
        "Хороший": 0.99, "Шоколад": 0.99
    },
    {   
        "Бабушка": 0.00, "Дед": 0.99, "Детство": 0.99, "Доброта": 0.99, "Женщина": 0.96, 
        "Лицо": 0.97, "Мама": 0.62, "Няня": 0.92, "Старая": 0.98, "Старушка": 0.97, 
        "Улыбка": 0.99
    },
    {   
        "Будущее": 0.97, "Было": 0.97, "Воспоминание": 0.00, "Впечатление": 0.97, 
        "Встреча": 0.86, "Друг": 0.89, "Знакомый": 0.97, "Игра": 0.94, "Любовь": 0.97, 
        "Море": 0.94, "Мороженое": 0.97, "Настроение": 0.40, "Отец": 0.97, "Пережить": 0.97, 
        "Праздник": 0.97, "Прекрасно": 0.97, "Происшествие": 0.94, "Радость": 0.86, 
        "Ребенок": 0.97, "Сад": 0.97, "Счастье": 0.25, "Удача": 0.97, "Чистый": 0.97, 
        "Чувство": 0.97
    },
    {   
        "Ветер": 0.64, "Веяние": 0.97, "Впечатление": 0.94, "Горы": 0.91, "Гроза": 0.97, 
        "Девушка": 0.97, "Дуновение": 0.88, "Дыхание": 0.73, "Еда": 0.97, "Езда": 0.82, 
        "Завтрак": 0.91, "Идея": 0.97, "Море": 0.94, "Ночь": 0.97, "Отдых": 0.91, 
        "Ощущение": 0.97, "Погода": 0.97, "Поездка": 0.85, "Полет": 0.94, "Поток": 0.55, 
        "Прогулка": 0.97, "Прохлада": 0.97, "Разум": 0.97, "Реакция": 0.94, "Река": 0.73, 
        "Струя": 0.00, "Тепло": 0.97, "Течение": 0.76, "Ум": 0.97, "Утро": 0.94, 
        "Чистый": 0.97, "Шампанское": 0.97, "Шар": 0.94
    },
    {   
        "Вкус": 0.91, "Галстук": 0.97, "Голос": 0.00, "Джаз": 0.98, "Знаменитый": 0.98, 
        "Знаток": 0.95, "Интеллект": 0.98, "Кантри": 0.97, "Мужчина": 0.98, "Намек": 0.98, 
        "Негр": 0.97, "Пластинка": 0.98, "Принц": 0.97, "Рок": 0.98, "Слух": 0.98, 
        "Стиль": 0.98, "Талант": 0.98, "Тенор": 0.98, "Успех": 0.98, "Ценитель": 0.92, 
        "Чернокожий": 0.98, "Юмор": 0.85
    },
    {   
        "Большой": 0.99, "Время": 0.95, "Год": 0.00, "День": 0.91, "Закрома": 0.99, 
        "Колос": 0.99, "Колосс": 0.99, "Месяц": 0.94, "Мысль": 0.99, "Неделя": 0.99, 
        "Осень": 0.99, "Период": 0.99, "Писатель": 0.99, "Сезон": 0.99, "Случай": 0.98, 
        "Сорт": 0.99, "Труд": 0.99, "Тяжелый": 0.99, "Хлеб": 0.99, "Час": 0.99
    },
    {   
        "Все": 0.99, "Глупость": 0.98, "Говорить": 0.00, "Дело": 0.97, "Думать": 0.99, 
        "Ерунда": 0.98, "Здесь": 0.98, "Книга": 0.99, "Нести": 0.95, "Нос": 0.99, 
        "Писать": 0.97, "Путь": 0.99, "Разговор": 0.90, "Сказать": 0.96, "Слово": 0.96, 
        "Смотреть": 0.99, "Читать": 0.99, "Шум": 0.98
    },
    {   
        "Взгляд": 0.06, "Глаз": 0.25, "Дужка": 0.96, "Зеркало": 0.98, "Зрение": 0.80, 
        "Нос": 0.00, "Носить": 0.96, "Оправа": 0.96, "Рог": 0.94, "Старик": 0.98, 
        "Стекло": 0.65
    },
    {   
        "Банка": 0.99, "Голова": 0.00, "Горох": 0.97, "Грядка": 0.99, "Извилина": 0.97, 
        "Капуста": 0.99, "Кладовая": 0.99, "Клетка": 0.98, "Кольцо": 0.98, "Корзина": 0.99, 
        "Коробка": 0.98, "Кость": 0.99, "Линия": 0.99, "Мысль": 0.99, "Работа": 0.96, 
        "Скамейка": 0.99, "Трата": 0.99, "Усталость": 0.97, "Участок": 0.97, "Центр": 0.98, 
        "Человек": 0.99, "Ячейка": 0.99
    },
    {   
        "Большой": 0.97, "Визит": 0.97, "Войти": 0.98, "Встреча": 0.00, "Долгожданный": 0.98, 
        "Зайти": 0.97, "Знакомство": 0.93, "Идти": 0.98, "Нежданный": 0.98, "Оказаться": 0.96, 
        "Поезд": 0.98, "Поездка": 0.95, "Попал": 0.97, "Попутчик": 0.97, "Посетил": 0.98, 
        "Прибытие": 0.98, "Приезд": 0.43, "Прийти": 0.92, "Путь": 0.98, "Случай": 0.98, 
        "Увидеть": 0.98
    }
];

const arraySelect = document.getElementById('arraySelect');
const searchInput = document.getElementById('searchInput');
const searchBtn = document.getElementById('searchBtn');
const resultsContainer = document.getElementById('resultsContainer');
const arrayInfo = document.getElementById('arrayInfo');

for (let i = 1; i <= 20; i++) {
    const option = document.createElement('option');
    option.value = i - 1;
    option.textContent = `Тройка #${i}`;
    if (i === 1) option.selected = true;
    arraySelect.appendChild(option);
}

function processKey(key) {
    return key.split(',')[0].trim();
}

function findSimilarWords(searchTerm, dataset) {
    const searchTermLower = searchTerm.toLowerCase();
    const minLength = Math.max(3, Math.floor(searchTerm.length * 0.7));
    
    const wordList = Object.keys(dataset).map(word => ({
        original: word,
        processed: processKey(word).toLowerCase()
    }));
    
    const exactMatch = wordList.find(item => 
        item.processed === searchTermLower
    );
    if (exactMatch) return exactMatch.original;
    
    const containsSearchTerm = wordList.filter(item => 
        item.processed.includes(searchTermLower) && 
        item.processed.length >= minLength
    );
    
    if (containsSearchTerm.length > 0) {
        return containsSearchTerm.sort((a, b) => 
            b.processed.length - a.processed.length
        )[0].original;
    }
    
    const isPartOfSearchTerm = wordList.filter(item => 
        searchTermLower.includes(item.processed) && 
        item.processed.length >= minLength
    );
    
    if (isPartOfSearchTerm.length > 0) {
        return isPartOfSearchTerm.sort((a, b) => 
            b.processed.length - a.processed.length
        )[0].original;
    }
    
    let bestMatch = null;
    let maxCommonLength = 0;
    
    for (const item of wordList) {
        let commonLength = 0;
        const minLen = Math.min(searchTermLower.length, item.processed.length);
        
        for (let i = 0; i < minLen; i++) {
            if (searchTermLower[i] === item.processed[i]) {
                commonLength++;
            } else {
                break;
            }
        }
        
        if (commonLength > maxCommonLength && commonLength >= 3) {
            maxCommonLength = commonLength;
            bestMatch = item.original;
        }
    }
    
    return bestMatch;
}

function performSearch() {
    const selectedArrayIndex = parseInt(arraySelect.value);
    let searchTerm = searchInput.value.trim();
    const selectedDataset = datasets[selectedArrayIndex];
    
    if (!searchTerm) {
        resultsContainer.innerHTML = '<div class="no-results">Введите ключ для поиска</div>';
        return;
    }
    
    let results = [];
    let resultType = "normal";
    
    const exactMatchKey = Object.keys(selectedDataset).find(
        key => processKey(key).toLowerCase() === searchTerm.toLowerCase()
    );
    
    if (exactMatchKey) {
        results = [[processKey(exactMatchKey), selectedDataset[exactMatchKey]]];
    } else {
        const similarWord = findSimilarWords(searchTerm, selectedDataset);
        
        if (similarWord) {
            results = [[processKey(similarWord), selectedDataset[similarWord]]];
            resultType = "similar";
        } else {
            selectedDataset[searchTerm] = 1.00;
            results = [[searchTerm, 1.00]];
            resultType = "new";
        }
    }
    
    displayResults(results, selectedArrayIndex, resultType);
}

function displayResults(results, arrayIndex, resultType) {
    const totalItems = Object.keys(datasets[arrayIndex]).length;
    
    resultsContainer.innerHTML = results.map(([key, value]) => {
        let itemClass = "";
        let typeBadge = "";
        
        if (resultType === "new") {
            itemClass = "new-item";
            typeBadge = '<div class="result-type type-new">новый элемент</div>';
        } else if (resultType === "similar") {
            itemClass = "similar-item";
            typeBadge = '<div class="result-type type-similar">однокоренное слово</div>';
        }
        
        return `
            <div class="result-item ${itemClass}">
                ${typeBadge}
                <div class="key">${key}</div>
                <div class="value">${value}</div>
            </div>
        `;
    }).join('');
    
    arrayInfo.textContent = `Массив #${arrayIndex + 1} | Всего элементов: ${totalItems}`;
}

arraySelect.addEventListener('change', () => {
    const index = parseInt(arraySelect.value);
    arrayInfo.textContent = `Массив #${index + 1} | Элементов: ${Object.keys(datasets[index]).length}`;
    searchInput.value = '';
    resultsContainer.innerHTML = '<div class="no-results">Введите ключ для поиска</div>';
});

searchBtn.addEventListener('click', performSearch);
searchInput.addEventListener('keyup', (e) => {
    if (e.key === 'Enter') performSearch();
});

arrayInfo.textContent = `Массив #1 | Элементов: ${Object.keys(datasets[0]).length}`;